

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>satlas.spectrum &mdash; SATLAS 1.0.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="SATLAS 1.0.0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="fa fa-home"> SATLAS</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../utilities.html"><tt class="docutils literal"><span class="pre">utilities</span></tt> &#8211; Collection of handy functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../utilities.html#module-satlas.utilities">Code documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../profiles.html"><tt class="docutils literal"><span class="pre">profiles</span></tt> &#8211; Implementation of lineshapes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../profiles.html#usage-example">Usage example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../profiles.html#module-satlas.profiles">Code documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../spectrum.html"><tt class="docutils literal"><span class="pre">spectrum</span></tt> &#8211; Analysis of hyperfine structures</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../spectrum.html#usage-examples">Usage examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spectrum.html#module-satlas.spectrum">Code documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../loglikelihood.html"><tt class="docutils literal"><span class="pre">loglikelihood</span></tt> &#8211; Calculation of loglikelihood for common distributions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../loglikelihood.html#module-satlas.loglikelihood">Code documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../relaxation.html"><tt class="docutils literal"><span class="pre">relaxation</span></tt> &#8211; Implementation of spin-lattice relaxation algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../relaxation.html#usage-examples">Usage examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../relaxation.html#module-satlas.relaxation">Code documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../polar.html"><tt class="docutils literal"><span class="pre">polar</span></tt> &#8211; Polarization simulations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../polar.html#module-satlas.polar">Code documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../collaps.html"><tt class="docutils literal"><span class="pre">collaps</span></tt> &#8211; API for interfacing with COLLAPS data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../collaps.html#module-collaps">Code documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">SATLAS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>satlas.spectrum</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <h1>Source code for satlas.spectrum</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: spectrum</span>
<span class="sd">    :platform: Windows</span>
<span class="sd">    :synopsis: Implementation of classes for the analysis of hyperfine</span>
<span class="sd">     structure spectra, including simultaneous fitting, various fitting</span>
<span class="sd">     routines and isomeric presence.</span>

<span class="sd">.. moduleauthor:: Wouter Gins &lt;wouter.gins@fys.kuleuven.be&gt;</span>
<span class="sd">.. moduleauthor:: Ruben de Groote &lt;ruben.degroote@fys.kuleuven.be&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">emcee</span> <span class="kn">as</span> <span class="nn">mcmc</span>
<span class="kn">import</span> <span class="nn">lmfit</span> <span class="kn">as</span> <span class="nn">lm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">satlas.loglikelihood</span> <span class="kn">as</span> <span class="nn">llh</span>
<span class="kn">import</span> <span class="nn">satlas.profiles</span> <span class="kn">as</span> <span class="nn">p</span>
<span class="kn">import</span> <span class="nn">satlas.utilities</span> <span class="kn">as</span> <span class="nn">utils</span>
<span class="kn">from</span> <span class="nn">satlas.wigner</span> <span class="kn">import</span> <span class="n">wigner_6j</span> <span class="k">as</span> <span class="n">W6J</span>


<div class="viewcode-block" id="PriorParameter"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.PriorParameter">[docs]</a><span class="k">class</span> <span class="nc">PriorParameter</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">Parameter</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Extended the Parameter class from LMFIT to incorporate prior boundaries.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">expr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">priormin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">priormax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PriorParameter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                                             <span class="n">vary</span><span class="o">=</span><span class="n">vary</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span>
                                             <span class="nb">max</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="n">expr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">priormin</span> <span class="o">=</span> <span class="n">priormin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">priormax</span> <span class="o">=</span> <span class="n">priormax</span>

</div>
<div class="viewcode-block" id="Spectrum"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum">[docs]</a><span class="k">class</span> <span class="nc">Spectrum</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Abstract baseclass for all spectra, such as :class:`SingleSpectrum`,</span>
<span class="sd">    :class:`CombinedSpectrum` and :class:`IsomerSpectrum`. For input, see these</span>
<span class="sd">    classes.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    selected: list of strings</span>
<span class="sd">        When a walk is performed and a triangle plot is created from the data,</span>
<span class="sd">        the parameters with one of these strings in their name will be</span>
<span class="sd">        displayed. Defaults to the hyperfine parameters and the centroid.</span>
<span class="sd">    loglikelifunc: {&#39;Poisson&#39;, &#39;Gaussian&#39;}</span>
<span class="sd">        Indicates if the Maximum Likelihood Estimation uses Poissonian or</span>
<span class="sd">        Gaussian formulas for the loglikelihood. Defaults to &#39;Poisson&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Spectrum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Al&#39;</span><span class="p">,</span> <span class="s">&#39;Au&#39;</span><span class="p">,</span> <span class="s">&#39;Bl&#39;</span><span class="p">,</span> <span class="s">&#39;Bu&#39;</span><span class="p">,</span> <span class="s">&#39;Cl&#39;</span><span class="p">,</span> <span class="s">&#39;Cu&#39;</span><span class="p">,</span> <span class="s">&#39;df&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atol</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loglikelifunc</span> <span class="o">=</span> <span class="s">&#39;poisson&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">loglikelifunc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">llh</span><span class="o">.</span><span class="n">Poisson</span><span class="p">:</span> <span class="s">&#39;Poisson&#39;</span><span class="p">,</span> <span class="n">llh</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">:</span> <span class="s">&#39;Gaussian&#39;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_loglikelifunc</span><span class="p">]</span>

    <span class="nd">@loglikelifunc.setter</span>
    <span class="k">def</span> <span class="nf">loglikelifunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;poisson&#39;</span><span class="p">:</span> <span class="n">llh</span><span class="o">.</span><span class="n">Poisson</span><span class="p">,</span> <span class="s">&#39;gaussian&#39;</span><span class="p">:</span> <span class="n">llh</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loglikelifunc</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">llh</span><span class="o">.</span><span class="n">Poisson</span><span class="p">)</span>

    <span class="nd">@abc.abstractmethod</span>
    <span class="k">def</span> <span class="nf">sanitize_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="c">##########################################</span>
    <span class="c"># MAXIMUM LIKELIHOOD ESTIMATION ROUTINES #</span>
    <span class="c">##########################################</span>
<div class="viewcode-block" id="Spectrum.loglikelihood"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum.loglikelihood">[docs]</a>    <span class="k">def</span> <span class="nf">loglikelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the total loglikelihood for the given parameter</span>
<span class="sd">        dictionary &#39;params&#39;. Uses the function defined in the attribute</span>
<span class="sd">        :attr:`loglikelifunc` to calculate the loglikelihood. Defaultly,</span>
<span class="sd">        this is set to a Poisson distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params: Parameters</span>
<span class="sd">            Instance of Parameters for which the loglikelihood has to be</span>
<span class="sd">            determined.</span>
<span class="sd">        x: array_like</span>
<span class="sd">            Frequencies in MHz.</span>
<span class="sd">        y: array_like</span>
<span class="sd">            Counts corresponding to :attr:`x`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_from_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">atol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atol</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seperate_response</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loglikelifunc</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Spectrum.lnprior"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum.lnprior">[docs]</a>    <span class="k">def</span> <span class="nf">lnprior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Defines the (uninformative) prior for all parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params: Parameters</span>
<span class="sd">            Instance of Parameters with values to be used in the fit/walk</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            If any of the parameters are out of bounds, returns</span>
<span class="sd">            :data:`-np.inf`, otherwise 1.0 is returned.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">leftbound</span><span class="p">,</span> <span class="n">rightbound</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">priormin</span><span class="p">,</span>
                                         <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">priormax</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">leftbound</span><span class="p">,</span> <span class="n">rightbound</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">max</span>
            <span class="n">leftbound</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="k">if</span> <span class="n">leftbound</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">leftbound</span>
            <span class="n">rightbound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="k">if</span> <span class="n">rightbound</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">rightbound</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">leftbound</span> <span class="o">&lt;=</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">rightbound</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="mf">1.0</span>
</div>
<div class="viewcode-block" id="Spectrum.lnprob"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum.lnprob">[docs]</a>    <span class="k">def</span> <span class="nf">lnprob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the sum of the loglikelihoods given the parameters</span>
<span class="sd">        :attr:`params`, while also checking the prior first. If this prior</span>
<span class="sd">        rejects the parameters, the parameters are not set for the spectrum.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params: Parameters</span>
<span class="sd">            Instance of Parameters for which the sum loglikelihood has to be</span>
<span class="sd">            calculated.</span>
<span class="sd">        x: array_like</span>
<span class="sd">            Frequencies in MHz.</span>
<span class="sd">        y: array_like</span>
<span class="sd">            Counts corresponding to :attr:`x`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            Sum of the loglikelihoods plus the result of the prior.&quot;&quot;&quot;</span>
        <span class="n">lp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lnprior</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lp</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">lp</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loglikelihood</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">res</span>
</div>
<div class="viewcode-block" id="Spectrum.likelihood_fit"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum.likelihood_fit">[docs]</a>    <span class="k">def</span> <span class="nf">likelihood_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">walking</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fit the spectrum to the spectroscopic data using the Maximum</span>
<span class="sd">        Likelihood technique. This is done by minimizing the negative sum of</span>
<span class="sd">        the loglikelihoods of the spectrum given the data (given by the method</span>
<span class="sd">        :meth:`lnprob`). Prints a statement regarding the success of the</span>
<span class="sd">        fitting.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x: array_like</span>
<span class="sd">            Frequency of the data, in MHz.</span>
<span class="sd">        y: array_like</span>
<span class="sd">            Counts corresponding to :attr:`x`.</span>
<span class="sd">        walking: Boolean</span>
<span class="sd">            Determines if a Monte Carlo walk is performed after the</span>
<span class="sd">            minimization to determine the errorbars and distribution of the</span>
<span class="sd">            parameters.</span>
<span class="sd">        kwargs: misc</span>
<span class="sd">            Keyword arguments passed on to the method :meth:`walk`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple or :class:`None`</span>
<span class="sd">            If any kind of plot is requested, a tuple containing these figures</span>
<span class="sd">            will be returned (see :meth:`walk` for more details). If no plot</span>
<span class="sd">            is requested, returns the value :class:`None`.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">negativeloglikelihood</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lnprob</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_input</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_from_var</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">Minimizer</span><span class="p">(</span><span class="n">negativeloglikelihood</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">fcn_args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">scalar_minimize</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;Nelder-Mead&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_from_params</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mle_fit</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mle_result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span>

        <span class="k">if</span> <span class="n">walking</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood_walk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Spectrum.likelihood_walk"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum.likelihood_walk">[docs]</a>    <span class="k">def</span> <span class="nf">likelihood_walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">walkers</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">burnin</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">store_walks</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs a random walk in the parameter space to determine the</span>
<span class="sd">        distribution for the best fit of the parameters.</span>

<span class="sd">        A message is printed before and after the walk.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        The errors calculated can be asymmetrical, but only the largest is</span>
<span class="sd">        saved as the overal uncertainty. This is a known issue, and work is</span>
<span class="sd">        being done to resolve this.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x: array_like</span>
<span class="sd">            Frequency of the data, in MHz.</span>
<span class="sd">        y: array_like</span>
<span class="sd">            Counts corresponding to :attr:`x`.</span>
<span class="sd">        nsteps: int, optional</span>
<span class="sd">            Number of steps to be taken, defaults to 2000.</span>
<span class="sd">        walkers: int, optional</span>
<span class="sd">            Number of walkers to be used, defaults to 20.</span>
<span class="sd">        burnin: float, optional</span>
<span class="sd">            Burn-in to be used for the walk. Expressed in percentage,</span>
<span class="sd">            defaults to 10.0.</span>
<span class="sd">        verbose: boolean, optional</span>
<span class="sd">            Controls printing the status of the sampling to the stdout.</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">        store_walks: boolean, optional</span>
<span class="sd">            For deeper debugging, the data from the walks can be saved and</span>
<span class="sd">            viewed later on&quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_from_var</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mle_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_from_var</span><span class="p">()</span>
        <span class="n">var_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">vars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span><span class="p">:</span>
                <span class="n">var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="nb">vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span>
        <span class="c"># pos = [vars + 1e-4 * np.random.randn(ndim) for i in range(walkers)]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">mcmc</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">sample_ball</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="p">[</span><span class="mf">1e-4</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">walkers</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_input</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">lnprobList</span><span class="p">(</span><span class="n">fvars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">groupParams</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fvars</span><span class="p">,</span> <span class="n">var_names</span><span class="p">):</span>
                <span class="n">groupParams</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lnprob</span><span class="p">(</span><span class="n">groupParams</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">groupParams</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">groupParams</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">PriorParameter</span><span class="p">(</span><span class="n">key</span><span class="p">,</span>
                                              <span class="n">value</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                              <span class="n">vary</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span><span class="p">,</span>
                                              <span class="n">expr</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span>
                                              <span class="n">priormin</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
                                              <span class="n">priormax</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
        <span class="n">sampler</span> <span class="o">=</span> <span class="n">mcmc</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span><span class="n">walkers</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">lnprobList</span><span class="p">,</span>
                                       <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">groupParams</span><span class="p">))</span>
        <span class="n">burn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nsteps</span> <span class="o">*</span> <span class="n">burnin</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Starting burn-in ({} steps)...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">burn</span><span class="p">))</span>
        <span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">burn</span><span class="p">,</span> <span class="n">storechain</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Starting walk ({} steps)...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nsteps</span> <span class="o">-</span> <span class="n">burn</span><span class="p">))</span>
        <span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">nsteps</span> <span class="o">-</span> <span class="n">burn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Done.&#39;</span><span class="p">)</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">flatchain</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">err</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="mf">16.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">84.0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">samp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
            <span class="n">q16</span><span class="p">,</span> <span class="n">q50</span><span class="p">,</span> <span class="n">q84</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">samp</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="n">val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q50</span><span class="p">)</span>
            <span class="n">err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">q50</span> <span class="o">-</span> <span class="n">q16</span><span class="p">,</span> <span class="n">q84</span> <span class="o">-</span> <span class="n">q50</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>
            <span class="n">params</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">params</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">e</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mle_fit</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_from_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">var_names</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mle_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">if</span> <span class="n">store_walks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">walks</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">sampler</span><span class="o">.</span><span class="n">chain</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_names</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">walks</span> <span class="o">=</span> <span class="bp">None</span>
</div>
    <span class="k">def</span> <span class="nf">generate_walks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">walks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">var_names</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">))))</span>
            <span class="n">figWalks</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">values</span><span class="p">),</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">walks</span><span class="p">):</span>
                <span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)])</span>
                <span class="n">a</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">figWalks</span><span class="p">,</span> <span class="n">axes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">generate_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_from_var</span><span class="p">()</span>
        <span class="n">var_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">vars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span><span class="p">:</span>
                <span class="n">var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="nb">vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_input</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">lnprobList</span><span class="p">(</span><span class="n">fvars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">groupParams</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fvars</span><span class="p">,</span> <span class="n">var_names</span><span class="p">):</span>
                <span class="n">groupParams</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lnprob</span><span class="p">(</span><span class="n">groupParams</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">groupParams</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">groupParams</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">PriorParameter</span><span class="p">(</span><span class="n">key</span><span class="p">,</span>
                                              <span class="n">value</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                              <span class="n">vary</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span><span class="p">,</span>
                                              <span class="n">expr</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span>
                                              <span class="n">priormin</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
                                              <span class="n">priormax</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_names</span><span class="p">):</span>
            <span class="n">best</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mle_fit</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mle_fit</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>
            <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="n">best</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span> <span class="n">best</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">std</span><span class="p">)</span>
            <span class="n">xvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">dummy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float&#39;</span><span class="p">)</span>
            <span class="n">yvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xvalues</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xvalues</span><span class="p">):</span>
                <span class="n">dummy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">yvalues</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">lnprobList</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">groupParams</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xvalues</span>
            <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yvalues</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var_from_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mle_fit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

<div class="viewcode-block" id="Spectrum.display_mle_fit"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum.display_mle_fit">[docs]</a>    <span class="k">def</span> <span class="nf">display_mle_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Give a readable overview of the result of the MLE fitting routine.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        The uncertainty shown is the largest of the asymmetrical errors! Work</span>
<span class="sd">        is being done to incorporate asymmetrical errors in the report; for</span>
<span class="sd">        now, rely on the triangle plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;mle_fit&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">fit_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mle_fit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Spectrum has not yet been fitted with this method!&#39;</span><span class="p">)</span>

    <span class="c">###############################</span>
    <span class="c"># CHI SQUARE FITTING ROUTINES #</span>
    <span class="c">###############################</span>
</div>
<div class="viewcode-block" id="Spectrum.chisquare_spectroscopic_fit"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum.chisquare_spectroscopic_fit">[docs]</a>    <span class="k">def</span> <span class="nf">chisquare_spectroscopic_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use the :meth:`FitToData` method, automatically estimating the errors</span>
<span class="sd">        on the counts by the square root.&quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_input</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">yerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">yerr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">yerr</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Spectrum.chisquare_fit"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum.chisquare_fit">[docs]</a>    <span class="k">def</span> <span class="nf">chisquare_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">errorByFit</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use a non-linear least squares minimization (Levenberg-Marquardt)</span>
<span class="sd">        algorithm to minimize the chi-square of the fit to data :attr:`x` and</span>
<span class="sd">        :attr:`y` with errorbars :attr:`yerr`. Reasonable bounds are used on</span>
<span class="sd">        parameters, and the user-supplied :attr:`self._vary` dictionary is</span>
<span class="sd">        consulted to see if a parameter should be varied or not.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x: array_like</span>
<span class="sd">            Frequency of the data, in MHz.</span>
<span class="sd">        y: array_like</span>
<span class="sd">            Counts corresponding to :attr:`x`.</span>
<span class="sd">        yerr: array_like</span>
<span class="sd">            Error bars on :attr:`y`.&quot;&quot;&quot;</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_input</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">Model</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">errorByFit</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var_from_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">errorByFit</span><span class="p">:</span>
                <span class="n">yerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="n">yerr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">yerr</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">model</span><span class="p">)</span> <span class="o">/</span> <span class="n">yerr</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_from_var</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">errorByFit</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span> <span class="o">=</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Spectrum.display_chisquare_fit"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum.display_chisquare_fit">[docs]</a>    <span class="k">def</span> <span class="nf">display_chisquare_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display all relevent info of the least-squares fitting routine,</span>
<span class="sd">        if this has been performed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        kwargs: misc</span>
<span class="sd">            Keywords passed on to :func:`fit_report` from the LMFit package.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;chisquare_fit&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Scaled errors estimated from covariance matrix.&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">fit_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Spectrum has not yet been fitted with this method!&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Spectrum.vars"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum.vars">[docs]</a>    <span class="k">def</span> <span class="nf">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s">&#39;any&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the variable names, values and estimated error bars for the</span>
<span class="sd">        parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        selection: string, optional</span>
<span class="sd">            Selects if the chisquare (&#39;chisquare&#39; or &#39;any&#39;) or MLE values are</span>
<span class="sd">            used. Defaults to &#39;any&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        names, values, uncertainties: tuple of lists</span>
<span class="sd">            Returns a 3-tuple of lists containing the names of the parameters,</span>
<span class="sd">            the values and the estimated uncertainties.&quot;&quot;&quot;</span>
        <span class="n">var</span><span class="p">,</span> <span class="n">var_names</span><span class="p">,</span> <span class="n">varerr</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;chisquare_fit&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">selection</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;chisquare&#39;</span>
                                               <span class="ow">or</span> <span class="n">selection</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;any&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span><span class="p">:</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">varerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;mle_fit&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mle_fit</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mle_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span><span class="p">:</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mle_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mle_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">varerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mle_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_from_var</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span><span class="p">:</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">varerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">var_names</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">varerr</span>
</div>
<div class="viewcode-block" id="Spectrum.chisquare_correlation_plot"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum.chisquare_correlation_plot">[docs]</a>    <span class="k">def</span> <span class="nf">chisquare_correlation_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If a chisquare fit has been performed, this method creates a figure</span>
<span class="sd">        for plotting the correlation maps between parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        selected: boolean, optional</span>
<span class="sd">            Controls if only the parameters defined in :attr:`selected` are</span>
<span class="sd">            used (True) or if all parameters are used (False). Defaults to True</span>
<span class="sd">        kwargs: keywords</span>
<span class="sd">            Other keywords are passed on to the :func:`conf_interval2d`</span>
<span class="sd">            function from lmfit. The exception is the keyword :attr:`limits`,</span>
<span class="sd">            which is now a float that indicates how many standard deviations</span>
<span class="sd">            have to be traveled.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.figure</span>
<span class="sd">            Returns the generated MatPlotLib figure&quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">FittingGrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span><span class="p">,</span>
                              <span class="n">selected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="k">if</span> <span class="n">selected</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">fig</span>
</div>
<div class="viewcode-block" id="Spectrum.calculate_confidence_intervals"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.Spectrum.calculate_confidence_intervals">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_confidence_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the confidence bounds for parameters by making use of</span>
<span class="sd">        lmfit&#39;s :func:`conf_interval` function. Results are saved in</span>
<span class="sd">        :attr:`self.chisquare_ci`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        selected: boolean, optional</span>
<span class="sd">            Boolean controlling if the used parameters are only the ones</span>
<span class="sd">            defined in the attribute :attr:`selected` (True), or if all</span>
<span class="sd">            parameters are to be used.&quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span><span class="o">.</span><span class="n">params</span>
                 <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span><span class="p">)]</span> <span class="k">if</span> <span class="n">selected</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chisquare_ci</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">conf_interval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chisquare_fit</span><span class="p">,</span>
                                             <span class="n">p_names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span>
                                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">display_ci</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lm</span><span class="o">.</span><span class="n">report_ci</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chisquare_ci</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="CombinedSpectrum"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.CombinedSpectrum">[docs]</a><span class="k">class</span> <span class="nc">CombinedSpectrum</span><span class="p">(</span><span class="n">Spectrum</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A class for combining different spectra (:class:`CombinedSpectrum`) or</span>
<span class="sd">    combining isomers/isotopes (:class:`IsomerSpectrum`, child class).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spectra: list of :class:`IsomerSpectrum` or :class:`SingleSpectrum` objects</span>
<span class="sd">        A list defining the different spectra.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CombinedSpectrum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span> <span class="o">=</span> <span class="n">spectra</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shared</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Al&#39;</span><span class="p">,</span>
                       <span class="s">&#39;Au&#39;</span><span class="p">,</span>
                       <span class="s">&#39;Bl&#39;</span><span class="p">,</span>
                       <span class="s">&#39;Bu&#39;</span><span class="p">,</span>
                       <span class="s">&#39;Cl&#39;</span><span class="p">,</span>
                       <span class="s">&#39;Cu&#39;</span><span class="p">,</span>
                       <span class="s">&#39;Offset&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="CombinedSpectrum.sanitize_input"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.CombinedSpectrum.sanitize_input">[docs]</a>    <span class="k">def</span> <span class="nf">sanitize_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Take the :attr:`x`, :attr:`y`, and :attr:`yerr` inputs, and sanitize</span>
<span class="sd">        them for the fit, meaning it should convert :attr:`y`/:attr:`yerr` to</span>
<span class="sd">        the output format of the class, and :attr:`x` to the input format of</span>
<span class="sd">        the class.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">yerr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yerr</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">yerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">yerr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span>
</div>
<div class="viewcode-block" id="CombinedSpectrum.params_from_var"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.CombinedSpectrum.params_from_var">[docs]</a>    <span class="k">def</span> <span class="nf">params_from_var</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Combine the parameters from the subspectra into one Parameters</span>
<span class="sd">        instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        params: Parameters instance describing the spectrum.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        Black magic going on in here, especially in the block of code</span>
<span class="sd">        describing the shared parameters.&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">params_from_var</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">old_key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="n">new_key</span> <span class="o">=</span> <span class="s">&#39;s&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">old_key</span>
                <span class="n">p</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">old_key</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">o_key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">n_key</span> <span class="o">=</span> <span class="s">&#39;s&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">o_key</span>
                        <span class="n">p</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">o_key</span><span class="p">,</span> <span class="n">n_key</span><span class="p">)</span>
            <span class="n">params</span> <span class="o">+=</span> <span class="n">p</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">IsomerSpectrum</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spectra</span><span class="p">):</span>
                        <span class="n">first_key</span> <span class="o">=</span> <span class="s">&#39;s0_s&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">key</span>
                        <span class="n">new_key</span> <span class="o">=</span> <span class="s">&#39;s&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">key</span>
                        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">new_key</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;s0_&#39;</span><span class="p">):</span>
                                    <span class="k">pass</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">params</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="n">first_key</span>
                                    <span class="n">params</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">IsomerSpectrum</span><span class="p">):</span>
                        <span class="n">first_key</span> <span class="o">=</span> <span class="s">&#39;s0_s0_&#39;</span> <span class="o">+</span> <span class="n">key</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">first_key</span> <span class="o">=</span> <span class="s">&#39;s0_&#39;</span> <span class="o">+</span> <span class="n">key</span>
                    <span class="n">new_key</span> <span class="o">=</span> <span class="s">&#39;s&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">key</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">new_key</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                            <span class="n">params</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="n">first_key</span>
                            <span class="n">params</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">params</span>
</div>
<div class="viewcode-block" id="CombinedSpectrum.var_from_params"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.CombinedSpectrum.var_from_params">[docs]</a>    <span class="k">def</span> <span class="nf">var_from_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a Parameters instance such as returned by the method</span>
<span class="sd">        :meth:`params_from_var`, set the parameters of the subspectra to the</span>
<span class="sd">        appropriate values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params: Parameters</span>
<span class="sd">            Parameters instance containing the information for the variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">IsomerSpectrum</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">spectra</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">k</span> <span class="o">=</span> <span class="s">&#39;s{!s}_s{!s}_&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                            <span class="n">dinkie</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                            <span class="n">new_name</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
                            <span class="n">new_name</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                            <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">dinkie</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                  <span class="n">vary</span><span class="o">=</span><span class="n">dinkie</span><span class="o">.</span><span class="n">vary</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">dinkie</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
                                  <span class="nb">max</span><span class="o">=</span><span class="n">dinkie</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="n">dinkie</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;s&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span><span class="p">):</span>
                        <span class="n">dinkie</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                        <span class="n">new_name</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">dinkie</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="n">dinkie</span><span class="o">.</span><span class="n">vary</span><span class="p">,</span>
                              <span class="nb">min</span><span class="o">=</span><span class="n">dinkie</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">dinkie</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="n">dinkie</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">var_from_params</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CombinedSpectrum.split_parameters"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.CombinedSpectrum.split_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">split_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function to split the parameters of the IsomerSpectrum</span>
<span class="sd">        instance into a list of parameters suitable for each subspectrum.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params: Parameters</span>
<span class="sd">            Parameters of the :class:`IsomerSpectrum` instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        p: list of Parameters</span>
<span class="sd">            A list of Parameters instances, each entry corresponding to the</span>
<span class="sd">            same entry in the attribute :attr:`spectra`.&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">):</span>
            <span class="n">par</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="p">):</span>
                    <span class="n">new_key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="p">):]</span>
                    <span class="n">expr</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span>
                    <span class="k">if</span> <span class="n">expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                            <span class="n">nk</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="p">):]</span>
                            <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">nk</span><span class="p">)</span>
                    <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_key</span><span class="p">,</span>
                            <span class="n">value</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                            <span class="n">vary</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span><span class="p">,</span>
                            <span class="nb">min</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
                            <span class="nb">max</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
                            <span class="n">expr</span><span class="o">=</span><span class="n">expr</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span>
</div>
<div class="viewcode-block" id="CombinedSpectrum.lnprior"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.CombinedSpectrum.lnprior">[docs]</a>    <span class="k">def</span> <span class="nf">lnprior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Defines the (uninformative) prior for all parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params: Parameters</span>
<span class="sd">            Instance of Parameters with values to be used in the fit/walk</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            If any of the parameters are out of bounds, returns :data:`-np.inf`</span>
<span class="sd">            , otherwise 1.0 is returned&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">lnprior</span><span class="p">(</span><span class="n">par</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">par</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">,</span> <span class="n">params</span><span class="p">)])</span>
</div>
    <span class="k">def</span> <span class="nf">seperate_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">seperate_response</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">X</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">,</span> <span class="n">x</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">s</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">X</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">,</span> <span class="n">x</span><span class="p">)])</span>

</div>
<div class="viewcode-block" id="IsomerSpectrum"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.IsomerSpectrum">[docs]</a><span class="k">class</span> <span class="nc">IsomerSpectrum</span><span class="p">(</span><span class="n">CombinedSpectrum</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Create a spectrum containing the information of multiple hyperfine</span>
<span class="sd">    structures. Most common use will be to fit a spectrum containing an isomer,</span>
<span class="sd">    hence the name of the class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spectra: list of :class:`SingleSpectrum` instances</span>
<span class="sd">        A list containing the base spectra&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IsomerSpectrum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shared</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="IsomerSpectrum.sanitize_input"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.IsomerSpectrum.sanitize_input">[docs]</a>    <span class="k">def</span> <span class="nf">sanitize_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Doesn&#39;t do anything yet.&quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">yerr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">yerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yerr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span>
</div>
<div class="viewcode-block" id="IsomerSpectrum.params_from_var"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.IsomerSpectrum.params_from_var">[docs]</a>    <span class="k">def</span> <span class="nf">params_from_var</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Combine the parameters from the subspectra into one Parameters</span>
<span class="sd">        instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        params: Parameters instance describing the spectrum&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">IsomerSpectrum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">params_from_var</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_key</span> <span class="o">=</span> <span class="s">&#39;s&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_Background&#39;</span>
                <span class="n">params</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">params</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">params</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">params</span>
</div>
<div class="viewcode-block" id="IsomerSpectrum.seperate_response"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.IsomerSpectrum.seperate_response">[docs]</a>    <span class="k">def</span> <span class="nf">seperate_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the response for each seperate spectrum for the values x,</span>
<span class="sd">        without background.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : float or array_like</span>
<span class="sd">            Frequency in MHz.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of floats or NumPy arrays</span>
<span class="sd">            Seperate responses of spectra to the input :attr:`x`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">s</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">s</span><span class="o">.</span><span class="n">background</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">]</span>
</div>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">IsomerSpectrum</span><span class="p">):</span>
            <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">spectra</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">SingleSpectrum</span><span class="p">):</span>
            <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span>
            <span class="n">spectra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;unsupported operand type(s)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">IsomerSpectrum</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">s</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="SingleSpectrum"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.SingleSpectrum">[docs]</a><span class="k">class</span> <span class="nc">SingleSpectrum</span><span class="p">(</span><span class="n">Spectrum</span><span class="p">):</span>

    <span class="sd">r&quot;&quot;&quot;Class for the construction of a HFS spectrum, consisting of different</span>
<span class="sd">    peaks described by a certain profile. The number of peaks and their</span>
<span class="sd">    positions is governed by the atomic HFS.</span>
<span class="sd">    Calling an instance of the Spectrum class returns the response value of the</span>
<span class="sd">    HFS spectrum for that frequency in MHz.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    I: float</span>
<span class="sd">        The nuclear spin.</span>
<span class="sd">    J: list of 2 floats</span>
<span class="sd">        The spins of the fine structure levels.</span>
<span class="sd">    ABC: list of 6 floats</span>
<span class="sd">        The hyperfine structure constants A, B and C for ground- and excited</span>
<span class="sd">        fine level. The list should be given as [A :sub:`lower`,</span>
<span class="sd">        A :sub:`upper`, B :sub:`lower`, B :sub:`upper`, C :sub:`upper`,</span>
<span class="sd">        C :sub:`lower`].</span>
<span class="sd">    df: float</span>
<span class="sd">        Center of Gravity of the spectrum.</span>
<span class="sd">    fwhm: float or list of 2 floats, optional</span>
<span class="sd">        Depending on the used shape, the FWHM is defined by one or two floats.</span>
<span class="sd">        Defaults to [50.0, 50.0]</span>
<span class="sd">    scale: float, optional</span>
<span class="sd">        Sets the strength of the spectrum, defaults to 1.0. Comparable to the</span>
<span class="sd">        amplitude of the spectrum.</span>

<span class="sd">    Other parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    shape : string, optional</span>
<span class="sd">        Sets the transition shape. String is converted to lowercase. For</span>
<span class="sd">        possible values, see :attr:`Spectrum.__shapes__.keys()`.</span>
<span class="sd">        Defaults to Voigt if an incorrect value is supplied.</span>
<span class="sd">    racah_int: Boolean, optional</span>
<span class="sd">        If True, fixes the relative peak intensities to the Racah intensities.</span>
<span class="sd">        Otherwise, gives them equal intensities and allows them to vary during</span>
<span class="sd">        fitting.</span>
<span class="sd">    shared_fwhm: Boolean, optional</span>
<span class="sd">        If True, the same FWHM is used for all peaks. Otherwise, give them all</span>
<span class="sd">        the same initial FWHM and let them vary during the fitting.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    fwhm : (list of) float or list of 2 floats</span>
<span class="sd">        Sets the FWHM for all the transtions. If :attr:`shared_fwhm` is True,</span>
<span class="sd">        this attribute is a list of FWHM values for each peak.</span>
<span class="sd">    relAmp : list of floats</span>
<span class="sd">        Sets the relative intensities of the transitions.</span>
<span class="sd">    scale : float</span>
<span class="sd">        Sets the amplitude of the global spectrum.</span>
<span class="sd">    background : float</span>
<span class="sd">        Sets the background of the global spectrum.</span>
<span class="sd">    ABC : list of 6 floats</span>
<span class="sd">        List of the hyperfine structure constants, organised as</span>
<span class="sd">        [A :sub:`lower`, A :sub:`upper`, B :sub:`lower`, B :sub:`upper`,</span>
<span class="sd">        C :sub:`upper`, C :sub:`lower`].</span>
<span class="sd">    n : integer</span>
<span class="sd">        Sets the number of Poisson sidepeaks.</span>
<span class="sd">    offset : float</span>
<span class="sd">        Sets the offset for the Poisson sidepeaks.</span>
<span class="sd">        The sidepeaks are located at :math:`i\cdot \text{offset}`,</span>
<span class="sd">        with :math:`i` the number of the sidepeak.</span>
<span class="sd">        Note: this means that a negative value indicates a sidepeak</span>
<span class="sd">        to the left of the main peak.</span>
<span class="sd">    poisson : float</span>
<span class="sd">        Sets the Poisson-factor for the Poisson sidepeaks.</span>
<span class="sd">        The amplitude of each sidepeak is multiplied by</span>
<span class="sd">        :math:`\text{poisson}^i/i!`, with :math:`i` the number of the sidepeak.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    The listed attributes are commonly accessed attributes for the end user.</span>
<span class="sd">    More are used, and should be looked up in the source code.&quot;&quot;&quot;</span>

    <span class="n">__shapes__</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;gaussian&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">,</span>
                  <span class="s">&#39;lorentzian&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">Lorentzian</span><span class="p">,</span>
                  <span class="s">&#39;irrational&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">Irrational</span><span class="p">,</span>
                  <span class="s">&#39;hyperbolic&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">HyperbolicSquared</span><span class="p">,</span>
                  <span class="s">&#39;extendedvoigt&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">ExtendedVoigt</span><span class="p">,</span>
                  <span class="s">&#39;pseudovoigt&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">PseudoVoigt</span><span class="p">,</span>
                  <span class="s">&#39;voigt&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">Voigt</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="p">[</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">background</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s">&#39;voigt&#39;</span><span class="p">,</span> <span class="n">racah_int</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">shared_fwhm</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SingleSpectrum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shapes__</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;&quot;Given profile shape not yet supported.</span>
<span class="s">            Defaulting to Voigt lineshape.&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="s">&#39;voigt&#39;</span>
            <span class="n">fwhm</span> <span class="o">=</span> <span class="p">[</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_relAmp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_racah_int</span> <span class="o">=</span> <span class="n">racah_int</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shared_fwhm</span> <span class="o">=</span> <span class="n">shared_fwhm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_I</span> <span class="o">=</span> <span class="n">I</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_J</span> <span class="o">=</span> <span class="n">J</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ABC</span> <span class="o">=</span> <span class="n">ABC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abc_limit</span> <span class="o">=</span> <span class="mf">30000.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm_limit</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span> <span class="o">=</span> <span class="n">df</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span> <span class="k">if</span> <span class="n">racah_int</span> <span class="k">else</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_background</span> <span class="o">=</span> <span class="n">background</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_energies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mu</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poisson</span> <span class="o">=</span> <span class="mf">0.609</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calculateLevels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>

<div class="viewcode-block" id="SingleSpectrum.set_variation"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.SingleSpectrum.set_variation">[docs]</a>    <span class="k">def</span> <span class="nf">set_variation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varyDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the variation of the fitparameters as supplied in the</span>
<span class="sd">        dictionary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        varydict: dictionary</span>
<span class="sd">            A dictionary containing &#39;key: True/False&#39; mappings</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        The list of usable keys:</span>

<span class="sd">        * :attr:`FWHM` (only for profiles with one float for the FWHM)</span>
<span class="sd">        * :attr:`eta`  (only for the Pseudovoigt profile)</span>
<span class="sd">        * :attr:`FWHMG` (only for profiles with two floats for the FWHM)</span>
<span class="sd">        * :attr:`FWHML` (only for profiles with two floats for the FWHM)</span>
<span class="sd">        * :attr:`Al`</span>
<span class="sd">        * :attr:`Au`</span>
<span class="sd">        * :attr:`Bl`</span>
<span class="sd">        * :attr:`Bu`</span>
<span class="sd">        * :attr:`Cl`</span>
<span class="sd">        * :attr:`Cu`</span>
<span class="sd">        * :attr:`df`</span>
<span class="sd">        * :attr:`Background`</span>
<span class="sd">        * :attr:`Poisson` (only if the attribute *n* is greater than 0)</span>
<span class="sd">        * :attr:`Offset` (only if the attribute *n* is greater than 0)&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">varyDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vary</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">varyDict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">I</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_I</span>

    <span class="nd">@I.setter</span>
    <span class="k">def</span> <span class="nf">I</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_I</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculateLevels</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">J</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_J</span>

    <span class="nd">@J.setter</span>
    <span class="k">def</span> <span class="nf">J</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_J</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculateLevels</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">background</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_background</span>

    <span class="nd">@background.setter</span>
    <span class="k">def</span> <span class="nf">background</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_background</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ABC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ABC</span>

    <span class="nd">@ABC.setter</span>
    <span class="k">def</span> <span class="nf">ABC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ABC</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_transitions</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span>

    <span class="nd">@df.setter</span>
    <span class="k">def</span> <span class="nf">df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_transitions</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span>

    <span class="nd">@scale.setter</span>
    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">racah_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_racah_int</span>

    <span class="nd">@racah_int.setter</span>
    <span class="k">def</span> <span class="nf">racah_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_racah_int</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_intensities</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">relAmp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relAmp</span>

    <span class="nd">@relAmp.setter</span>
    <span class="k">def</span> <span class="nf">relAmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_relAmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">prof</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="n">prof</span><span class="o">.</span><span class="n">amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fwhm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fwhm</span>

    <span class="nd">@fwhm.setter</span>
    <span class="k">def</span> <span class="nf">fwhm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_fwhm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fwhm</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">prof</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
                <span class="n">prof</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;extendedvoigt&#39;</span><span class="p">,</span> <span class="s">&#39;voigt&#39;</span><span class="p">]</span>
                <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">value</span><span class="p">))</span>
                <span class="ow">and</span> <span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fwhm</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fwhm</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">prof</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">):</span>
                <span class="n">prof</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">v</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mu</span>

    <span class="nd">@mu.setter</span>
    <span class="k">def</span> <span class="nf">mu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mu</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">prof</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="n">prof</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span>

    <span class="nd">@n.setter</span>
    <span class="k">def</span> <span class="nf">n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">poisson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poisson</span>

    <span class="nd">@poisson.setter</span>
    <span class="k">def</span> <span class="nf">poisson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poisson</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span>

    <span class="nd">@offset.setter</span>
    <span class="k">def</span> <span class="nf">offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">calculateLevels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_F</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_I</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_J</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_I</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_J</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_I</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_J</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_I</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_J</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_transitions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_intensities</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_calculate_transitions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_energies</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_F_level_energy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">F</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_F_level_energy</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">F</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">F1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_F</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">F2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_F</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">F2</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">F2</span> <span class="o">==</span> <span class="n">F1</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">mu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">len</span><span class="p">(</span><span class="n">mu</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__shapes__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">]()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mu</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>

    <span class="k">def</span> <span class="nf">_calculate_intensities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ampl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ampl</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">F1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_F</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">F2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_F</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_racah_intensity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_J</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">_J</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                       <span class="n">F1</span><span class="p">,</span>
                                                       <span class="n">F2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">ampl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relAmp</span> <span class="o">=</span> <span class="n">ampl</span>

    <span class="k">def</span> <span class="nf">calculate_racah_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">J1</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">F2</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">F1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">F2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> \
            <span class="n">W6J</span><span class="p">(</span><span class="n">J2</span><span class="p">,</span> <span class="n">F2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_I</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">J1</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<div class="viewcode-block" id="SingleSpectrum.calculate_F_level_energy"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.SingleSpectrum.calculate_F_level_energy">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_F_level_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;The hyperfine addition to a central frequency (attribute :attr:`df`)</span>
<span class="sd">        for a specific level is calculated. The formula comes from</span>
<span class="sd">        :cite:`Schwartz1955` and in a simplified form, reads</span>

<span class="sd">        .. math::</span>
<span class="sd">            C_F &amp;= F(F+1) - I(I+1) - J(J+1)</span>

<span class="sd">            D_F &amp;= \frac{3 C_F (C_F + 1) - 4 I (I + 1) J (J + 1)}{2 I (2 I - 1)</span>
<span class="sd">            J (2 J - 1)}</span>

<span class="sd">            E_F &amp;= \frac{10 (\frac{C_F}{2})^3 + 20(\frac{C_F}{2})^2 + C_F(-3I(I</span>
<span class="sd">            + 1)J(J + 1) + I(I + 1) + J(J + 1) + 3) - 5I(I + 1)J(J + 1)}{I(I -</span>
<span class="sd">            1)(2I - 1)J(J - 1)(2J - 1)}</span>

<span class="sd">            E &amp;= df + \frac{A C_F}{2} + \frac{B D_F}{4} + C E_F</span>

<span class="sd">        A, B and C are the dipole, quadrupole and octupole hyperfine</span>
<span class="sd">        parameters. Octupole contributions are calculated when both the</span>
<span class="sd">        nuclear and electronic spin is greater than 1, quadrupole contributions</span>
<span class="sd">        when they are greater than 1/2, and dipole contributions when they are</span>
<span class="sd">        greater than 0.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        level: int, 0 or 1</span>
<span class="sd">            Integer referring to the lower (0) level, or the upper (1) level.</span>
<span class="sd">        F: integer or half-integer</span>
<span class="sd">            F-quantum number for which the hyperfine-corrected energy has to be</span>
<span class="sd">            calculated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        energy: float</span>
<span class="sd">            Energy in MHz.&quot;&quot;&quot;</span>
        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_I</span>
        <span class="n">J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_J</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ABC</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>
        <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ABC</span><span class="p">[</span><span class="n">level</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ABC</span><span class="p">[</span><span class="n">level</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">I</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">J</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">C_F</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">D_F</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">E_F</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">I</span> <span class="o">==</span> <span class="o">.</span><span class="mi">5</span> <span class="ow">or</span> <span class="n">J</span> <span class="o">==</span> <span class="o">.</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">C_F</span> <span class="o">=</span> <span class="n">F</span> <span class="o">*</span> <span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">I</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">D_F</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">E_F</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">I</span> <span class="o">==</span> <span class="mf">1.</span> <span class="ow">or</span> <span class="n">J</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">):</span>
            <span class="n">C_F</span> <span class="o">=</span> <span class="n">F</span> <span class="o">*</span> <span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">I</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">D_F</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">C_F</span> <span class="o">*</span> <span class="p">(</span><span class="n">C_F</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span>
                   <span class="mi">4</span> <span class="o">*</span> <span class="n">I</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span>\
                  <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">I</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">I</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">J</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">E_F</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">C_F</span> <span class="o">=</span> <span class="n">F</span> <span class="o">*</span> <span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">I</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">D_F</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">C_F</span> <span class="o">*</span> <span class="p">(</span><span class="n">C_F</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span>
                   <span class="mi">4</span> <span class="o">*</span> <span class="n">I</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span>\
                  <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">I</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">I</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">J</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">E_F</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">C_F</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">C_F</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                   <span class="o">+</span> <span class="n">C_F</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">I</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">I</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span>
                   <span class="mi">5</span> <span class="o">*</span> <span class="n">I</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span>\
                  <span class="p">(</span><span class="n">I</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">I</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">J</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">df</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">C_F</span> <span class="o">+</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">B</span> <span class="o">*</span> <span class="n">D_F</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">E_F</span>
</div>
    <span class="k">def</span> <span class="nf">sanitize_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span>

<div class="viewcode-block" id="SingleSpectrum.var_from_params"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.SingleSpectrum.var_from_params">[docs]</a>    <span class="k">def</span> <span class="nf">var_from_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a Parameters instance &#39;params&#39;, the value-fields for all the</span>
<span class="sd">        parameters are extracted and used to set the values of the spectrum.</span>
<span class="sd">        Will raise a KeyError exception if an unsuitable instance is</span>
<span class="sd">        supplied.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params: Parameters</span>
<span class="sd">            Instance of Parameters to set all values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;extendedvoigt&#39;</span><span class="p">,</span> <span class="s">&#39;voigt&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_fwhm</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;FWHM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;FWHM&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span>
                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">))]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;pseudovoigt&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
                    <span class="n">part</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;eta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_fwhm</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;FWHMG&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;FWHML&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="p">[[</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;FWHMG&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                              <span class="n">params</span><span class="p">[</span><span class="s">&#39;FWHML&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">))]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;scale&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relAmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;Amp&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span>
                       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">))]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ABC</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;Al&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;Au&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">[</span><span class="s">&#39;Bl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;Bu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">[</span><span class="s">&#39;Cl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;Cu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;Background&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;N&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Poisson</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;Poisson&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Offset</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;Offset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</div>
<div class="viewcode-block" id="SingleSpectrum.params_from_var"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.SingleSpectrum.params_from_var">[docs]</a>    <span class="k">def</span> <span class="nf">params_from_var</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Goes through all the relevant parameters of the spectrum,</span>
<span class="sd">        and returns a Parameters instance containing all the information. User-</span>
<span class="sd">        supplied information in the self._vary dictionary is used to set</span>
<span class="sd">        the variation of parameters during the fitting, while</span>
<span class="sd">        making sure that the A, B and C parameters are not used if the spins</span>
<span class="sd">        do not allow it.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Parameters</span>
<span class="sd">            Instance suitable for the method :meth:`var_from_params`.&quot;&quot;&quot;</span>
        <span class="n">par</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;extendedvoigt&#39;</span><span class="p">,</span> <span class="s">&#39;voigt&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_fwhm</span><span class="p">:</span>
                <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;FWHM&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="nb">min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm_limit</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">):</span>
                    <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;FWHM&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="nb">min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm_limit</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;pseudovoigt&#39;</span><span class="p">]:</span>
                <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;eta&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_fwhm</span><span class="p">:</span>
                <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;FWHMG&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="nb">min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm_limit</span><span class="p">)</span>
                <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;FWHML&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="nb">min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm_limit</span><span class="p">)</span>
                <span class="n">val</span> <span class="o">=</span> <span class="mf">0.5346</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.2166</span> <span class="o">*</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
                                                      <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;TotalFWHM&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">expr</span><span class="o">=</span><span class="s">&#39;0.5346*FWHML+sqrt(0.2166*FWHML**2+FWHMG**2)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">):</span>
                    <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;FWHMG&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="nb">min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm_limit</span><span class="p">)</span>
                    <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;FWHML&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="nb">min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm_limit</span><span class="p">)</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="mf">0.5346</span> <span class="o">*</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.2166</span> <span class="o">*</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
                                                    <span class="o">+</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;TotalFWHM&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">expr</span><span class="o">=</span><span class="s">&#39;0.5346*FWHML&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span>
                                 <span class="s">&#39;+sqrt(0.2166*FWHML&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span>
                                 <span class="s">&#39;**2+FWHMG&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;**2)&#39;</span><span class="p">)</span>

        <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;scale&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">racah_int</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prof</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">):</span>
            <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Amp&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_relAmp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">vary</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">racah_int</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abc_limit</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">abc_limit</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">abc_limit</span><span class="p">)</span>
        <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Al&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ABC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Au&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ABC</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Bl&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ABC</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Bu&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ABC</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Cl&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ABC</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Cu&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ABC</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Au&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;*Al&#39;</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Au&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Bu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;*Bl&#39;</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Bu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Cu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;*Cl&#39;</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Cu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;df&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Background&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;N&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Poisson&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_Poisson</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Offset&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_Offset</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vary</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">par</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">par</span><span class="p">[</span><span class="s">&#39;N&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_I</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Al&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Al&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Au&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Au&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_I</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Bl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Bl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Bu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Bu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_J</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Bl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Bl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_J</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Bu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Bu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_I</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Cl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Cl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Cu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Cu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_J</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Cl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Cl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_J</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Cu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">par</span><span class="p">[</span><span class="s">&#39;Cu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">par</span>
</div>
<div class="viewcode-block" id="SingleSpectrum.bootstrap"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.SingleSpectrum.bootstrap">[docs]</a>    <span class="k">def</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bootstraps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">selected</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given an experimental spectrum of counts, generate a number of</span>
<span class="sd">        bootstrapped resampled spectra, fit these, and return a pandas</span>
<span class="sd">        DataFrame containing result of fitting these resampled spectra.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x: array_like</span>
<span class="sd">            Frequency in MHz.</span>
<span class="sd">        y: array_like</span>
<span class="sd">            Counts corresponding to :attr:`x`.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        bootstraps: integer, optional</span>
<span class="sd">            Number of bootstrap samples to generate, defaults to 100.</span>
<span class="sd">        samples: integer, optional</span>
<span class="sd">            Number of counts in each bootstrapped spectrum, defaults to</span>
<span class="sd">            the number of counts in the supplied spectrum.</span>
<span class="sd">        selected: boolean, optional</span>
<span class="sd">            Selects if only the parameters in :attr:`self.selected` are saved</span>
<span class="sd">            in the DataFrame. Defaults to True (saving only the selected).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DataFrame</span>
<span class="sd">            DataFrame containing the results of fitting the bootstrapped</span>
<span class="sd">            samples.&quot;&quot;&quot;</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="n">names</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">varerr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="s">&#39;chisquare&#39;</span><span class="p">)</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="k">if</span> <span class="n">selected</span> <span class="k">else</span> <span class="n">names</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bootstraps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="n">columns</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
        <span class="n">stderrs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bootstraps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                               <span class="n">columns</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">]</span>
        <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">varerr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">]</span>
        <span class="n">stderrs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bootstraps</span><span class="p">):</span>
            <span class="n">newy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span>
                            <span class="n">dist</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
                            <span class="p">),</span>
                    <span class="n">minlength</span><span class="o">=</span><span class="n">length</span>
                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chisquare_spectroscopic_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">newy</span><span class="p">)</span>
            <span class="n">names</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">varerr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="s">&#39;chisquare&#39;</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">]</span>
            <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">varerr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">]</span>
            <span class="n">stderrs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">pan</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="s">&#39;stderr&#39;</span><span class="p">:</span> <span class="n">stderrs</span><span class="p">}</span>
        <span class="n">pan</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="n">pan</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pan</span>
</div>
<div class="viewcode-block" id="SingleSpectrum.__add__"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.SingleSpectrum.__add__">[docs]</a>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add two spectra together to get an :class:`IsomerSpectrum`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other: Spectrum</span>
<span class="sd">            Other spectrum to add.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        IsomerSpectrum</span>
<span class="sd">            An Isomerspectrum combining both spectra.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">SingleSpectrum</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">IsomerSpectrum</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="SingleSpectrum.seperate_response"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.SingleSpectrum.seperate_response">[docs]</a>    <span class="k">def</span> <span class="nf">seperate_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the response for each seperate spectrum for the values :attr:`x`</span>
<span class="sd">        , without background.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : float or array_like</span>
<span class="sd">            Frequency in MHz.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of floats or NumPy arrays</span>
<span class="sd">            Seperate responses of spectra to the input :attr:`x`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="SingleSpectrum.__call__"><a class="viewcode-back" href="../../spectrum.html#satlas.spectrum.SingleSpectrum.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the response for frequency :attr:`x` (in MHz) of the spectrum.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : float or array_like</span>
<span class="sd">            Frequency in MHz</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float or NumPy array</span>
<span class="sd">            Response of the spectrum for each value of :attr:`x`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poisson</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">([</span><span class="n">prof</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
                                                <span class="k">for</span> <span class="n">prof</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">])</span> \
                    <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">([</span><span class="n">prof</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">prof</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span></div></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Wouter Gins.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>