<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>Estimating correlation through analytical calculations and random walk &mdash; SATLAS 0.1.0b11 documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-extend.css">
    <link rel="stylesheet" href="../_static/scipy.css" type="text/css" >
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" >
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.0b11',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/copybutton.js"></script>
    <link rel="top" title="SATLAS 0.1.0b11 documentation" href="../index.html" >
    <link rel="up" title="Tutorials" href="../tutorial.html" >
    <link rel="next" title="References" href="../references.html" >
    <link rel="prev" title="Plotting routines" href="plottingroutines.html" > 
  </head>
  <body>

  <div class="container">
    <div class="header">
    </div>
  </div>


    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
	
        <li class="active"><a href="../index.html">SATLAS 0.1.0b11 documentation</a></li>
	
          <li class="active"><a href="../tutorial.html" accesskey="U">Tutorials</a></li> 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="../genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
      <li class="active">
        <a href="../py-modindex.html" title="Python Module Index"
           >modules</a>
      </li>
      <li class="active">
        <a href="../references.html" title="References"
           accesskey="N">next</a>
      </li>
      <li class="active">
        <a href="plottingroutines.html" title="Plotting routines"
           accesskey="P">previous</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body">
            
  <div class="section" id="estimating-correlation-through-analytical-calculations-and-random-walk">
<h1>Estimating correlation through analytical calculations and random walk<a class="headerlink" href="#estimating-correlation-through-analytical-calculations-and-random-walk" title="Permalink to this headline">¶</a></h1>
<div class="section" id="random-walk-versus-analytical-calculation">
<h2>Random walk versus analytical calculation<a class="headerlink" href="#random-walk-versus-analytical-calculation" title="Permalink to this headline">¶</a></h2>
<p>When the uncertainty on the parameters has to be estimated for the case
of fitting through the loglikelihood, another option presents itself.</p>
<p>Using a random walk through parameter space, the distribution for each
parameter can be explored and used to estimate both the best value and
the uncertainty boundaries. This approach has the added advantage that
the code is more stable: using the analytical calculations, the repeated
fitting can slightly change the numbers involved, making the code a bit
more fragile. The disadvantage of the random walk is that convergence is
not guaranteed, nor can the number of steps needed be calculated
beforehand.</p>
<p>Another advantage of the random walk is that the correlation between
parameters is automatically calculated as well.</p>
<p>For the example dataset:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">satlas</span> <span class="kn">as</span> <span class="nn">s</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">J</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span>

<span class="n">ABC</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">background</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>

<span class="n">base</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">HFSModel</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">background_params</span><span class="o">=</span><span class="n">background</span><span class="p">)</span>

<span class="n">frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2700</span><span class="p">,</span> <span class="mi">3300</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">base</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">frequency</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">base</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">base</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">frequency</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">
C:UsersMyStuffAnaconda3libsite-packagesIPythonhtml.py:14: ShimWarning: The <cite>IPython.html</cite> package has been deprecated. You should import from <cite>notebook</cite> instead. <cite>IPython.html.widgets</cite> has moved to <cite>ipywidgets</cite>.
  &quot;<cite>IPython.html.widgets</cite> has moved to <cite>ipywidgets</cite>.&quot;, ShimWarning)
C:UsersMyStuffAnaconda3libsite-packagesmatplotlib__init__.py:872: UserWarning: axes.color_cycle is deprecated and replaced with axes.prop_cycle; please use the latter.
  warnings.warn(self.msg_depr % (key, alt_key))
</pre>
<img alt="../_images/output_1_2.png" src="../_images/output_1_2.png" />
</div>
<div class="section" id="analytical-correlation-maps">
<h2>Analytical correlation maps<a class="headerlink" href="#analytical-correlation-maps" title="Permalink to this headline">¶</a></h2>
<p>To make analytical correlation maps and 1D likelihood parabola&#8217;s, the
command is</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">s</span><span class="o">.</span><span class="n">likelihood_fit</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">generate_correlation_map</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;mle&#39;</span><span class="p">,</span> <span class="n">resolution_diag</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">resolution_map</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>FWHMG: 100% ||                                                   | ETA:  0:00:00

FWHML: 100% ||                                                   | ETA:  0:00:00

Amp1__2: 100% ||                                                 | ETA:  0:00:00

Centroid: 100% ||                                                | ETA:  0:00:00

Background0: 100% ||                                             | ETA:  0:00:01

FWHMG FWHML: 100% ||                                             | ETA:  0:00:10

FWHMG Amp1__2: 100% ||                                           | ETA:  0:00:00

FWHML Amp1__2: 100% ||                                           | ETA:  0:00:02

FWHMG Centroid: 100% ||                                          | ETA:  0:00:00

FWHML Centroid: 100% ||                                          | ETA:  0:00:00

Amp1__2 Centroid: 100% ||                                        | ETA:  0:00:00

FWHMG Background0: 100% ||                                       | ETA:  0:00:00

FWHML Background0: 100% ||                                       | ETA:  0:00:01

Amp1__2 Background0: 100% ||                                     | ETA:  0:00:15

Centroid Background0: 100% ||                                    | ETA:  0:00:37
</pre></div>
</div>
<img alt="../_images/output_3_2.png" src="../_images/output_3_2.png" />
<p>As can be seen here, the resolution of the correlation maps is clearly
visible. Since the resolution defines the number of datapoints on each
axis, the calculation time goes as <img class="math" src="../_images/math/b0614445362e91ebcad2b2650b0eab330c60a5ea.png" alt="N^2"/>, so increasing the
resolution increases the calculation time drastically.</p>
<p>Also clearly visible is the fact that the uncertainties are, at least in
some cases, non-gaussian. Especially in the FWHM of the profile and in
the background parameter, the deviation from a parabolic behaviour is
evident.</p>
</div>
<div class="section" id="generating-and-plotting-random-walks">
<h2>Generating and plotting random walks<a class="headerlink" href="#generating-and-plotting-random-walks" title="Permalink to this headline">¶</a></h2>
<p>Initiating the random walk can be done by using the dedicated function,
or by passing the <em>walking=True</em> keyword to the likelihood fitting
method, which will automatically start the walk.</p>
<p>Due to memory concerns, the results from the random walk are saved in a
file in either the current directory if only the filename is given, or
in another directory if that location is also given.</p>
<p>The random walk algorithm employs the <em>emcee</em> package, and more details
on arguments for the walk algorithm can be found there.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">s</span><span class="o">.</span><span class="n">likelihood_fit</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">walking</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">walk_kws</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;filename&#39;</span><span class="p">:</span> <span class="s">&#39;demonstration.h5&#39;</span><span class="p">,</span> <span class="s">&#39;nsteps&#39;</span><span class="p">:</span> <span class="mi">5000</span><span class="p">})</span>
<span class="n">s</span><span class="o">.</span><span class="n">generate_correlation_plot</span><span class="p">(</span><span class="s">&#39;demonstration.h5&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Walk:100% ||                                                     | ETA:  0:00:00
Generating plots: 100% ||                                        | ETA:  0:00:00
</pre></div>
</div>
<img alt="../_images/output_6_2.png" src="../_images/output_6_2.png" />
<p>We see that the correlation plots show the same behaviour as in the
analytical case. A small one-bin peak is also still evident in most of
the plots. This might be the result of burnin (see the <em>emcee</em>
documentation for more information on this).</p>
</div>
<div class="section" id="comparison-of-the-two-methods">
<h2>Comparison of the two methods<a class="headerlink" href="#comparison-of-the-two-methods" title="Permalink to this headline">¶</a></h2>
<p>The main difference between the two methods is that the analytical
method works by continuously fitting and refitting the data, while the
random walk judges the quality of each random step. This results in an
important distinction, namely that <strong>the analytical method might not
converge</strong>, while the random walk might get into a region where there is
no difference between random steps, and <strong>will therefore explore the
entire region</strong>, instead of being confined to the best fitting area.
Both options have their pros, cons and gotchas, and care needs to be
taken in selecting which method is to be used.</p>
</div>
</div>


          </div>
        </div>
          </div>
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Estimating correlation through analytical calculations and random walk</a><ul>
<li><a class="reference internal" href="#random-walk-versus-analytical-calculation">Random walk versus analytical calculation</a></li>
<li><a class="reference internal" href="#analytical-correlation-maps">Analytical correlation maps</a></li>
<li><a class="reference internal" href="#generating-and-plotting-random-walks">Generating and plotting random walks</a></li>
<li><a class="reference internal" href="#comparison-of-the-two-methods">Comparison of the two methods</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="plottingroutines.html"
                        title="previous chapter">Plotting routines</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../references.html"
                        title="next chapter">References</a></p>
  <h3>This Page</h3>
  <div>
    <a href="../_sources/tutorials/randomwalk.txt"
       rel="nofollow">Show Source</a>
  </div>
        </div>
      </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2015, Wouter Gins.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>